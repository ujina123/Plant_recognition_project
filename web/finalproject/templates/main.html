{% load static %}
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<!-- ê¸°ì¡´ css -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/plantrecog.css' %}">
    <title>Plant Doctor</title>
	<!--í•œê¸€ í°íŠ¸ -->
	<link rel="preconnect" href="https://fonts.googleapis.com"> 
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
	<link href="https://fonts.googleapis.com/css2?family=Dongle:wght@300&family=Gamja+Flower&family=Noto+Sans+KR:wght@300;400&display=swap" rel="stylesheet">
	<!-- ìƒë‹¨ë°” ë§í¬ -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- ì¤‘ëª¨í˜• jquery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		// ë‚ ì”¨ ê´€ë ¨ script
		function getLoc() {
				// ì‚¬ìš©ì ìœ„ì¹˜
				var userLoc = document.getElementById("userloc")
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(getPos, getErr)
				} else {
					userLoc.innerHTML = "ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤."
				}
		}
		function getPos(pos) {
			const lat = pos.coords.latitude
			const lng = pos.coords.longitude
			$.ajax({
				url: "https://dapi.kakao.com/v2/local/geo/coord2address.json?x=" + lng + "&y=" + lat,
				type: "GET",
				headers: {
					"Authorization" : "KakaoAK 0a04a8468406a22d0281480d598e655e"
				},
				success: function(data) {
					var addrS = data.documents[0].address.address_name.split(" ")
					if (addrS[0] == "ì„œìš¸") {
						var addr = "ì„œìš¸íŠ¹ë³„ì‹œ"
					} else if (addrS[1].substr(-1) == "ì‹œ" | addrS[1].substr(-1) == "êµ°") {
						var addr = addrS[1]
					} else {
						var addr = addrS[0] + "ê´‘ì—­ì‹œ"
					}
					const userLoc = document.getElementById("userloc")
					// ì‚¬ìš©ì ìœ„ì¹˜ ì–´ë”˜ì§€ 
					userLoc.innerHTML = addr
					if (addr) {
						const con = document.getElementById("condi")
						const tem = document.getElementById("temp")
						const humid = document.getElementById("humidity")
						const uV = document.getElementById("uv")
						const fore = document.getElementById("foreTemp")
						$.ajax({
							url: "weather/?loc=" + addr,
							type: "GET",
							success: function(data) {
								con.innerHTML = data[0].condi
								tem.innerHTML = data[0].temp + "Â°C"
								humid.innerHTML = data[0].humidity + "%"
								uV.innerHTML = data[0].uv
								for (i=0; i<24; i++) {
									var sp = document.createElement("span")
									var b1 = document.createElement("b")
									var b2 = document.createElement("b")
									b1.innerHTML = data[i].time + "ì‹œ"
									b2.innerHTML = data[i].temp + "Â°C"
									sp.append(b1,b2)
									fore.appendChild(sp)
								}
							},
							error: function(e) {
								console.log(e)
							}
						})
					}
				},
				error: function(e) {
					console.log(e)
				}
			}
		)}
		function getErr(error) {
			var userLoc = document.getElementById("userloc")
			switch(error.code) {
				case error.PERMISSION_DENIED:
					userLoc.innerHTML = "ìœ„ì¹˜ ì •ë³´ ê¶Œí•œ ì—†ìŒ"
					break
				case error.POSITION_UNAVAILABLE:
					userLoc.innerHTML = "ìœ„ì¹˜ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ì—†ìŒ"
					break
				case error.TIMEOUT:
					userLoc.innerHTML = "ìœ„ì¹˜ ì •ë³´ ìš”ì²­ ì‹œê°„ ì´ˆê³¼"
					break
				case error.UNKNOWN_ERROR:
					userLoc.innerHTML = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ"
					break
			}
		}
		getLoc()

		function history_back() {
			history.back();
		}
	</script>
	<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© script -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
	<script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<style>      
		.main-container{
			text-align: center;
		}
		.txt {
			margin-right: 13%;
		}
		.myplant {
			width: 100%;
			text-align: center;
			justify-content: center;
			display: inline-block;
			border-radius: 5pt;
			margin-bottom: 3%;
			background-color:#f9f9f9;
			border:0.5px solid #ccc;
		}
		.img{
			width: 7%;
			border-radius: 50%;
		}
		div {
			font-family: 'ACCchildrenheartOTF-Regular';
			font-size: 12pt;
			font-weight: bold;
		}
		body {
			font-size: 13pt;
		}
		/* ìƒë‹¨ë°” css */
		/* í˜œì¸: icon-bar position, bottom, left ì¶”ê°€, position: sticky ì§€ì›€ */
		.icon-bar {
			position: fixed;
			bottom: 0px;
			left: 0px;
			width: 100%; /* Full-width */
			background-color: #555; /* Dark-grey background */
			overflow: auto; /* Overflow due to float */
			/* position: sticky; */
		}
		.icon-bar a {
			float: left; /* Float links side by side */
			text-align: center; /* Center-align text */
			width: 25%; /* Equal width (5 icons with 20% width each = 100%) */
			padding: 12px 0; /* Some top and bottom padding */
			transition: all 0.3s ease; /* Add transition for hover effects */
			color: white; /* White text color */
			font-size: 36px; /* Increased font size */
		}
		.icon-bar a:hover {
			background-color: #000; /* Add a hover color */
		}
		.active {
			background-color: #04AA6D; /* Add an active/current color */
		}
		.login{
			background-color:#04AA6D;
			border-radius: 5pt;
			color: cornsilk;
			width: 23%;
			font-size: 9pt;
			font-family: 'EliceDigitalBaeum-Bd'; 
		}
		.logout{
			background-color:#04AA6D;
			border-radius: 5pt;
			color: cornsilk;
			width: 23%;
			font-size: 9pt;
			font-family: 'EliceDigitalBaeum-Bd'; 
		}
		.weather {
			float: left;
			margin-right: 5%;
			font-weight: bold;
		}

		/* ACC ì–´ë¦°ì´ ë§ˆìŒê³ ìš´ì²´ */
		@font-face {
    		font-family: 'ACCchildrenheartOTF-Regular';
    		src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112-2@1.0/ACCchildrenheartOTF-Regular.woff') format('woff');
    		font-weight: normal;
    		font-style: normal;
		}
		/* ì—˜ë¦¬ìŠ¤ë””ì§€í„¸ë°°ì›€ì²´ */
		@font-face {
			font-family: 'EliceDigitalBaeum-Bd';
			src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_elice@1.0/EliceDigitalBaeum-Bd.woff2') format('woff2');
			font-weight: normal;
			font-style: normal;
		}

		/* sliderbar css */
		ul {list-style:none;}
		b {text-decoration:none; color:inherit; margin-right: 12%; font-size: 11pt;}
		.box {max-width:960px; width:100%; height:67px; border:0.5px solid #ccc; margin:0 auto; border-radius: 5pt; margin-bottom: 5%;}
		#tab {
			height: 65px;
		}
		span {
			height: 65px;
			border-radius: 5pt;
			white-space: pre-line;
			width: 25%;
		}
		#tab ul{white-space:nowrap; overflow-x: auto; text-align:center; background:#f9f9f9;}
		#tab ul span{display:inline-block; padding: 5px 5px; background:#f9f9f9;}

		/* ë¬¼ì£¼ê¸° slider css */
		.swiper {
        	white-space: nowrap;
        	overflow-x: scroll;
        	padding: 24px;
        	padding-bottom: 7px;
      	}

      	.swiper li {
			width: 136px;
			height: 80px;
			background-size: cover;
			background-position: center;
			display: inline-block;
			border-radius: 5px;
			margin-right: 2%;
      	}
    </style>
</head>
<body>
	<div class="file-upload">
		<a href="{% url 'main' %}" style="margin-left: 5%; margin-right: 8%;">
			<img src="{% static 'img/website_logo.png' %}" style="width: 55%; margin-bottom: 8%;">
		</a>

		<!-- ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ë°”ë€Œê²Œí•˜ê¸°! -->
		{% if not user.is_authenticated %}
			<button onclick="location.href='{% url 'account_login' %}'" class="login">ë¡œê·¸ì¸</button>
		{% else %}
			<button onclick="location.href='{% url 'account_logout' %}'" class="logout">ë¡œê·¸ì•„ì›ƒ</button>
		{% endif %}	 
		<div style="border-radius: 5pt; background-color: #f4f4f4; height: 11vh; padding:2%; border:0.5px solid #ccc; width: 93%; margin-left: 3%;">
			<div id="userloc" style="margin-bottom: 2%;"></div>
			<div class="weather">ğŸ’¡ì˜¨ë„ :</div>
			<div id="temp" class="weather"></div>
			<div class="weather">ğŸ’¡ë‚ ì”¨ :</div>
			<div id="condi" class="weather"></div>	
		</div>
		<br>

		<div class="myplant" style="width: 93%; margin-left: 3%;">
			<div style="margin-left: 30%;">
				<div class="weather" style="margin-left: 15%;">ìŠµë„</div>
				<div id="humidity" class="weather"></div>
				<br>
				<div class="weather">ìì™¸ì„  ì§€ìˆ˜</div>
				<div id="uv" class="weather"></div>			
			</div>
		</div>
		<br><br>
		<div class="box" style="width: 93%; margin-left: 3%;">
			<div id="tab">
				<ul id="foreTemp"></ul>
			</div>
		</div>
		<br>

		<!-- ë‚´ì‹ë¬¼ ê´€ë¦¬í•˜ê¸° íšŒì› ë¹„íšŒì› ê¸°ëŠ¥ êµ¬ë¶„ -->
		{% if not user.is_authenticated %}
			<div class="myplant" style="padding: 5%; font-family: 'Noto Sans KR', sans-serif; background-color: #f4f4f4;">
				<div onclick="location.href='{% url 'account_login' %}'"  style=" margin-top: 2%; margin-left: 2%; font-size: 16pt;">
					<img src="{% static 'img/plant_cute.jpeg' %}" style="width: 32%; margin-bottom: 5%;">
					<div style="font-size: 13pt; font-weight: bold;">ì‹ë¬¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
					<i class="fa fa-plus-circle" aria-hidden="true"></i>
				</div>
			</div>

		{% else %}
			<div class="myplant" style="padding: 7%; height: 26vh; width: 93%; margin-left: 3%;">
				<div style="font-size: 19pt; float: left; margin-right: 20%; font-weight: bold;">ì–¸ì œ ë¬¼ì¤¬ì§€?</div>
				<button onclick="location.href='{% url 'plantinfo' %}'" style="border-radius: 5pt; background-color: #04AA6D; color: cornsilk; padding: 2%; font-family: 'EliceDigitalBaeum-Bd';">ë‚˜ì˜ ì‹ë¬¼ ê´€ë¦¬</button>
		
				<ul class="swiper">
					{% for o in obj %}
						<li>
							<img src="{{o.plant.url}}" style="width: 50%; text-decoration:none; color:inherit; margin-right: 7%; border-radius: 50%; border:0.5px solid #ccc;">
							<b style="color: rgba(11, 97, 50, 0.571);">{{o.nickname}}</b>
							<br>
							<b>ë¬¼ì£¼ê¸° D{{o.nextdate|datedelta}}</b>
						</li>
					{% endfor %}
				</ul>
			</div>
		{% endif %}
		<br>
</body>
<div class="icon-bar">
	<a class="active" href="{% url 'main' %}"><i class="fa fa-home"></i></a>
	<a href="{% url 'plantimage:plantimage' %}"><i class="fa fa-pagelines"></i></a>
	<a href="{% url 'diseaseimage:diseaseimage' %}"><i class="fa fa-medkit" aria-hidden="true"></i></a>
	<a href="{% url 'search' %}"><i class="fa fa-search"></i></a>
</div>
</html>